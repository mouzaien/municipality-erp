<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core">
<f:view>


	<h:head>

		<link
			href="#{facesContext.externalContext.requestContextPath}/resources/css/style.css"
			rel="stylesheet" type="text/css"></link>
	</h:head>
	<script type="text/javascript">
		window.onload = window.history.forward(0);
	</script>
	<h:body>

		<ui:composition template="/pages/menuBar.xhtml">

			<ui:define name="content">




				<p class="text-center">
					<h:outputLabel styleClass="btxt"
						style="font-weight:bold; font-size:30px;" value="#{msg['bills']}">
					</h:outputLabel>

				</p>

				<h:form id="includeform">


					<p:messages autoUpdate="true" closable="true"></p:messages>
					<div class="col-lg-12"
						style="background-color: white; border-top: 5px solid #428BCA">
						<br></br>
						<div style="color: color: #428bca">
							<h3 class="page-header"
								style="margin: 0px 0 20px ! important; color: #428bca">#{msg['bill.data']}
							</h3>
						</div>

						<div class="panel-body">
							<div class="row">
								<div class="col-md-12">


									<h:panelGroup rendered="#{billBean.consultMode}">
										<div class="row">
											<div class="col-md-2">
												<h:outputLabel value="#{msg['bill.number']}"
													styleClass="btxt" />
											</div>
											<div class="col-md-3">
												<h:outputLabel value="#{billBean.payLicBill.billNumber}" />
											</div>
										</div>
										<br />
										<br />
									</h:panelGroup>
									<div class="row">
										<div class="col-md-2">
											<h:outputLabel value="#{msg['category']}" styleClass="btxt" />
										</div>
										<div class="col-md-3">
											<h:selectOneMenu id="categoryList"
												disabled="#{billBean.consultMode}"
												value="#{billBean.payLicBill.licenceType}"
												style="width:100%; dir:rtl;">
												<f:selectItems value="#{loadingDataBean.billCategoriesList}"
													var="categ" itemLabel="#{categ.label}"
													itemValue="#{categ.code}" />
											</h:selectOneMenu>
										</div>
									</div>
									<br /> <br />
									<div class="row">
										<div class="col-md-2">
											<h:outputLabel value="#{msg['bill.owner.name']}"
												styleClass="btxt" />
										</div>
										<div class="col-md-3">
											<h:inputText value="#{billBean.payLicBill.billOwnerName}"
												disabled="#{billBean.consultMode}" styleClass="form-control" />
										</div>
									</div>
									<br />
									<div class="row">
										<div class="col-md-2">
											<h:outputLabel value="#{msg['national.id']}"
												styleClass="btxt" />
										</div>
										<div class="col-md-3">
											<p:spinner id="nationalId" required="true"
												style="width:100% !important;" maxlength="10"
												requiredMessage="#{msg['required.fields']}"
												validatorMessage="#{msg['error.NationalId']}"
												value="#{billBean.payLicBill.nationalId}">
												<f:validator validatorId="validators.nationalIdValidator" />
												<p:ajax process="@this" />
											</p:spinner>
										</div>
										<br></br>
									</div>
									<br /> <br />
									<div class="row">
										<div class="col-md-2">
											<h:outputLabel value="#{msg['bill.owner.phone']}"
												styleClass="btxt" />
										</div>
										<div class="col-md-3">
											<h:inputText value="#{billBean.payLicBill.payInstallNumber}"
												converterMessage="#{msg['error.phone.number']}"
												required="true" requiredMessage="يجب ادخال الجوال"
												disabled="#{billBean.consultMode}" styleClass="form-control">
												<f:validator validatorId="utilities.PhoneNumberValidator" />
											</h:inputText>
										</div>
									</div>
									<br /> <br />
									<h:panelGroup rendered="#{!billBean.consultMode}">
										<div class="row">
											<div class="col-md-2">
												<h:outputLabel value="#{msg['item.name']}"
													rendered="#{!billBean.consultMode}" styleClass="btxt" />
											</div>
											<div class="col-md-3">
												<p:selectOneMenu id="itemsList" filter="true"
													filterMatchMode="contains"
													rendered="#{!billBean.consultMode}"
													value="#{billBean.selectedItemId}">
													<f:selectItem itemLabel="أختر من البنود" itemValue="" />
													<f:selectItems value="#{billBean.itemsList}" var="categ"
														itemLabel="#{categ.accountNumber} - #{categ.name}"
														itemValue="#{categ.accountNumber}" />
												</p:selectOneMenu>

											</div>




										</div>

										<div class="row">

											<div class="col-md-2" />
											<div class="col-md-1">
												<p:inputText value="#{billBean.amount}" placeholder="المبلغ"
													rendered="#{!billBean.consultMode}" size="5"
													styleClass="form-control" />

											</div>
											<div class="col-md-3">
												<h:commandButton value="#{msg['add']}"
													rendered="#{!billBean.consultMode}" icon="fa fa-paperclip"
													styleClass="btn btn-primary">

													<f:ajax execute="@form" render="@form"
														listener="#{billBean.addNewItem}" />
												</h:commandButton>

											</div>


										</div>

										<br />
										<br />
									</h:panelGroup>
									<br /> <br />

									<div class="row" align="center">
										<div class="col-md-2"></div>
										<div class="col-md-8">
											<div class="table-responsive">
												<table id="itemsTB"
													class="table table-striped table-bordered table-hover">
													<thead>
														<tr>
															<th width="20%" style="text-align: center;">#{msg['item.number']}</th>
															<th width="50%" style="text-align: center;">#{msg['item.name']}</th>
															<th width="20%" style="text-align: center;">#{msg['amount']}</th>
															<th width="10%"></th>
														</tr>
													</thead>
													<tbody>
														<ui:repeat var="item" value="#{billBean.detailsBillList}">
															<tr>
																<td style="text-align: center;"><h:outputText
																		value="#{item.payDetails}" /></td>
																<td>#{item.itemLabel}</td>
																<td style="text-align: center;"><h:outputText
																		value="#{item.amount}">
																		<f:convertNumber pattern="#0.00" />
																	</h:outputText></td>
																<td style="text-align: center;"><h:commandButton
																		id="delete" value="#{msg['delete']}"
																		icon="fa fa-paperclip"
																		rendered="#{!billBean.consultMode}"
																		styleClass="btn btn-primary">

																		<f:setPropertyActionListener value="#{item}"
																			target="#{billBean.selectedItem}" />
																		<f:ajax execute="delete" render="@form"></f:ajax>
																	</h:commandButton></td>

															</tr>

														</ui:repeat>
													</tbody>
													<tfoot>
														<tr>

															<th />
															<th style="text-align: left;">#{msg['total']}</th>
															<th style="text-align: center;"><h:outputText
																	value="#{billBean.totalAmountBill}">
																	<f:convertNumber pattern="#0.00" />
																</h:outputText></th>
															<th />
														</tr>
													</tfoot>
												</table>
											</div>
										</div>
									</div>

									<div class="container-fluid">
										<div class="row">

											<div class="col-md-8"></div>
											<div class="col-md-1">
												<h:commandButton value="#{msg['change.bill']}"
													style="width:100%;" rendered="#{billBean.consultMode}"
													styleClass="btn btn-primary"
													action="#{billBean.changeBillAction}">
													<f:ajax execute="@form" render="@form"></f:ajax>
												</h:commandButton>
											</div>
											<div class="col-md-1">
												<h:commandButton value="#{msg['save']}" style="width:100%;"
													rendered="#{!billBean.consultMode}"
													styleClass="btn btn-primary"
													onclick="this.form.target='_blank'"
													actionListener="#{billBean.saveBillAction}">
													<f:ajax execute="@form" render="@form"></f:ajax>
												</h:commandButton>
											</div>

											<div class="col-md-1">
												<h:commandButton value="طباعة" immediate="true"
													style="width:100%;" styleClass="btn btn-primary"
													onclick="this.form.target='_blank'"
													action="#{billBean.printBillReport}">
												</h:commandButton>
											</div>
											<div class="col-md-1">
												<h:commandButton value="#{msg['back']}" action="search_bill"
													style="width:100%;" immediate="true"
													styleClass="btn btn-primary">
													<f:ajax execute="@form"></f:ajax>
												</h:commandButton>
											</div>
										</div>
									</div>


								</div>
							</div>
						</div>
					</div>
				</h:form>
			</ui:define>
		</ui:composition>

	</h:body>
</f:view>
</html>
