<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://xmlns.jcp.org/jsf/core">
<f:view>

	<h:head>

		<!-- <link
			href="#{facesContext.externalContext.requestContextPath}/resources/css/style.css"
			rel="stylesheet" type="text/css"></link> -->
	</h:head>
	<script type="text/javascript">
		window.onload = window.history.forward(0);
	</script>
	<br />
	<h:body>

		<ui:composition template="/template.xhtml">
			<p:growl autoUpdate="true" showDetail="false" />

			<ui:define name="content">
				<h:form id="includeform">
					<p:messages autoUpdate="true" closable="true"></p:messages>
					<div class="card car-w-title" dir="rtl">
						<div align="left" class="image-box-footer">
							<p:commandButton value="إضافة عقوبة" styleClass="cyan-btn"
								immediate="true" action="#{penalitiesListBean.addPenality}"
								icon="ui-icon-add">
							</p:commandButton>
							<p:spacer width="10" height="10"></p:spacer>
							<p:commandButton value="طباعة اكسيل" ajax="false"
								styleClass="orange-btn" icon="fa fa-fw fa-file-excel-o"
								immediate="true">

								<p:dataExporter encoding="UTF-8" type="xls"
									postProcessor="#{penalitiesListBean.postProcessXLS}"
									target="inboxdt" fileName="المخالفات"></p:dataExporter>
							</p:commandButton>
							<p:spacer width="10" height="10"></p:spacer>
							<p:commandButton value="طباعة الكل" ajax="false"
								onclick="this.form.target='_blank'" styleClass="purple-btn"
								icon="ui-icon ui-icon-print" immediate="true"
								action="#{penalitiesListBean.printAllFines}">
							</p:commandButton>
						</div>

						<h1 style="color: #7CB342; text-align: center;">#{msg['list.penalities']}
						</h1>

						<br />
						<div class="panel-body" style="padding: 0px;">
							<div class="ui-g">
								<div class="ui-g-1">
									<h:outputLabel styleClass="btxt" value="حالة المخالفة" />
								</div>
								<div class="ui-g-2">
									<p:selectOneMenu styleClass="form-control" style="width:70%"
										value="#{penalitiesListBean.fineStatus}">
										<f:selectItem itemLabel="الكل" itemValue="-1" />
										<f:selectItem itemLabel="تحت الاجراء" itemValue="R" />
										<f:selectItem itemLabel="تم الموافقة عليها" itemValue="Y" />
										<f:selectItem itemLabel="تم رفضها" itemValue="N" />
										<p:ajax process="@this" update="inboxdt"
											listener="#{penalitiesListBean.loadPenalitiesByType}"></p:ajax>
									</p:selectOneMenu>
								</div>
								<div class="ui-g-1">
									<h:outputLabel styleClass="btxt" value="نوع النشاط" />
								</div>
								<div class="ui-g-2">
									<p:selectOneMenu styleClass="form-control" style="width:70%"
										filter="true" filterMatchMode="contains"
										value="#{penalitiesListBean.fineTradeType}">
										<f:selectItem itemLabel="الكل" itemValue="-1" />
										<f:selectItems value="#{penalitiesListBean.activityList}"
											var="categ" itemLabel="#{categ.name}" itemValue="#{categ.id}" />
										<p:ajax process="@this" update="inboxdt"
											listener="#{penalitiesListBean.loadPenalitiesByType}"></p:ajax> activityList
									</p:selectOneMenu>
								</div>
								<div class="ui-g-1">
									<h:outputLabel styleClass="btxt" value="حالة السداد" />
								</div>
								<div class="ui-g-2">
									<p:selectOneMenu styleClass="form-control" style="width:70%"
										value="#{penalitiesListBean.fineSadad}">
										<f:selectItem itemLabel="الكل" itemValue="-1" />
										<f:selectItem itemLabel="غير مسددة" itemValue="0" />
										<f:selectItem itemLabel="مسددة" itemValue="1" />
										<p:ajax process="@this" update="inboxdt"
											listener="#{penalitiesListBean.loadPenalitiesByType}"></p:ajax>
									</p:selectOneMenu>
								</div>

							</div>
							<div class="ui-g">
								<div class="ui-g-1">
									<p:outputLabel value="رقم الرخصة"></p:outputLabel>
								</div>
								<div class="ui-g-2">
									<p:inputText value="#{penalitiesListBean.licNo}"
										style="width:85%">
										<p:ajax process="@this" />
										<!-- 										<f:validator validatorId="nationalIdValidator" /> -->
									</p:inputText>

								</div>
								<div class="ui-g-1">
									<p:outputLabel value="رقم السجل المدنى"></p:outputLabel>
								</div>
								<div class="ui-g-2">
									<p:inputText value="#{penalitiesListBean.alpNo}"
										style="width:85%">
										<p:ajax process="@this" />
									</p:inputText>
								</div>
							</div>
							<!-- 							<div class="ui-g"> -->
							<!-- 								<div class="ui-g-3 ui-md-6 ui-lg-3"> -->
							<!-- 									<h:outputLabel value="هجري  :  " /> -->
							<!-- 									<p:selectBooleanCheckbox -->
							<!-- 										value="#{penalitiesListBean.higriMode}"> -->
							<!-- 										<p:ajax update="pngDate" process="@this"></p:ajax> -->
							<!-- 									</p:selectBooleanCheckbox> -->
							<!-- 								</div> -->
							<!-- 							</div> -->
							<!-- 							<h:panelGroup id="pngDate"> -->
							<div class="ui-g">

								<div class="ui-g-1">
									<p:outputLabel value="تاريخ  المخالفة من" styleClass="btxt" />
								</div>
								<div class="ui-g-2">
									<!-- 									<p:inputText id="fromStDate" -->
									<!-- 										rendered="#{penalitiesListBean.higriMode}" -->
									<!-- 										value="#{penalitiesListBean.fromStartDate}" -->
									<!-- 										onfocus="loadCalendar();" style="width:85%" -->
									<!-- 										styleClass="form-control form-controlCal"> -->
									<!-- 										<p:ajax process="@this" /> -->
									<!-- 									</p:inputText> -->

									<p:inputText id="fromStDate"
										rendered="#{penalitiesListBean.higriMode}"
										value="#{penalitiesListBean.fromStartDate}"
										onfocus="loadCalendar();" style="width:85%"
										styleClass="form-control form-controlCal">
										<p:ajax process="@this" />
									</p:inputText>

									<p:calendar value="#{penalitiesListBean.fromStartDateG}"
										pattern="dd/MM/yyyy" style="width: 100%" id="dfrom"
										rendered="#{!penalitiesListBean.higriMode}">
										<p:ajax process="@this" />
									</p:calendar>
								</div>
								<div class="ui-g-1">
									<p:outputLabel value="إلى" styleClass="btxt" />
								</div>
								<div class="ui-g-2">
									<p:inputText id="toStartDate"
										rendered="#{penalitiesListBean.higriMode}"
										value="#{penalitiesListBean.toStartDate}"
										onfocus="loadCalendar();" style="width:85%"
										styleClass="form-control form-controlCal">
										<p:ajax process="@this" />
									</p:inputText>
									<p:calendar value="#{penalitiesListBean.toStartDateG}"
										pattern="dd/MM/yyyy" style="width: 100%" id="dto"
										rendered="#{!penalitiesListBean.higriMode}">
										<p:ajax process="@this" />
									</p:calendar>
								</div>

								<div class="ui-g-2">
									<p:commandButton value="استعلام" style="float:left;"
										immediate="true" icon="ui-icon ui-icon-refresh"
										action="#{penalitiesListBean.loadPenalitiesByType}"
										process="@this " update="inboxdt">
									</p:commandButton>
								</div>

							</div>
							<!-- 							</h:panelGroup> -->
							<br />


							<p:dataTable value="#{penalitiesListBean.penalitiesList}"
								var="penalItem" id="inboxdt" widgetVar="penal_dt"
								paginator="true" rows="10" emptyMessage="لا توجد بيانات"
								rowIndexVar="rowIndex" paginatorPosition="bottom" sortBy="#{1}"
								filteredValue="#{penalitiesListBean.filteredPenalities}"
								paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">

								<f:facet name="header">
									<p:outputPanel>
										<h:outputText value="ابحث فى كل الحقول:" />
										<p:inputText id="globalFilter"
											onkeyup="PF('cellemp').filter()" style="width:150px"
											placeholder="كلمة البحث">
										</p:inputText>
									</p:outputPanel>
								</f:facet>
								<p:column style="text-align: center;"
									headerText="#{msg['penality.number']}"
									filterBy="#{penalItem.fineNo}" filterMatchMode="contains"
									width="10%">
									<p:outputLabel value="#{penalItem.fineNo}"></p:outputLabel>
								</p:column>
								<!-- 								<p:column style="text-align: center;" -->
								<!-- 									headerText="رقم الاشعار" -->
								<!-- 									filterBy="#{penalItem.notifyMasterId}" filterMatchMode="contains" -->
								<!-- 									width="10%"> -->
								<!--                                     #{penalItem.notifyMasterId} -->
								<!--                                 </p:column> -->
								<!-- 								<p:column style="white-space: nowrap;text-align: center;" -->
								<!-- 									headerText="تاريخ الاشعار" width="10%" -->
								<!-- 									filterBy="#{penalItem.notifyDate}" filterMatchMode="contains"> -->
								<!-- 									<h:outputLabel value="#{penalItem.notifyDate}"> -->
								<!-- 										<f:convertDateTime pattern="yyyy-MM-dd"></f:convertDateTime> -->
								<!-- 									</h:outputLabel> -->

								<!-- 								</p:column> -->


								<p:column style="white-space: nowrap;text-align: center;"
									headerText="تاريخ المخالفة" width="10%"
									filterBy="#{penalItem.fineDate}" filterMatchMode="contains">
									<p:outputLabel value="#{penalItem.fineDate}"></p:outputLabel>
								</p:column>

								<p:column style="white-space: nowrap;text-align: center;"
									headerText="رقم السجل التجارى" width="10%"
									filterBy="#{penalItem.mahlId}" filterMatchMode="contains">
									<p:outputLabel value="#{penalItem.mahlId}"></p:outputLabel>
								</p:column>
								<p:column style="white-space: nowrap;text-align: center;"
									headerText="رقم السجل المدنى" width="10%"
									filterBy="#{penalItem.fIdNo}" filterMatchMode="contains">
									<p:outputLabel value="#{penalItem.fIdNo}"></p:outputLabel>
								</p:column>

								<p:column headerText="#{msg['name']}" width="20%"
									filterBy="#{penalItem.fName}" filterMatchMode="contains">
									<p:outputLabel value="#{penalItem.fName}"></p:outputLabel>
								</p:column>

								<p:column headerText="#{msg['commercial.name']}" width="20%"
									filterBy="#{penalItem.fTradeMarkName}"
									filterMatchMode="contains">
									<p:outputLabel value="#{penalItem.fTradeMarkName}"></p:outputLabel>
								</p:column>
								<p:column style="text-align: center;"
									headerText="#{msg['licence.number']}" width="10%"
									filterBy="#{penalItem.fLicenceNo}">
									<p:outputLabel value="#{penalItem.fLicenceNo}"></p:outputLabel>
								</p:column>
								<p:column filterBy="#{penalItem.fFineCase}"
									filterMatchMode="contains"
									headerText="#{msg['payment.status']}" width="8%">

									<h:outputLabel
										value="#{(penalItem.fFineCase==1)? msg['paid'] : msg['not.paid']}"
										style="color:#{(penalItem.fFineCase==1)? 'green' : 'red'}"></h:outputLabel>

								</p:column>

								<p:column headerText="المراقب" width="15%"
									filterBy="#{penalItem.supervisorNameView}"
									filterMatchMode="contains">

									<p:outputLabel value="#{penalItem.supervisorNameView}"></p:outputLabel>
								</p:column>
								<p:column headerText="قيمة المخالفة" width="15%"
									filterBy="#{penalItem.fineAmount}" filterMatchMode="contains">
									<p:outputLabel value="#{penalItem.fineAmount}"></p:outputLabel>
								</p:column>

								<p:column width="5%" style="text-align:center"
									headerText="#{msg['details']}">
									<p:commandButton oncomplete="PF('penality_dlg').show()"
										action="#{penalitiesListBean.loadSelectedPenalty}"
										process="@this" icon="ui-icon-search"
										update="includeform:myDialog">
										<f:setPropertyActionListener value="#{penalItem}"
											target="#{penalitiesListBean.reqFinesMaster}" />
									</p:commandButton>
								</p:column>
								<!-- 								<p:summaryRow> -->
								<!-- 									<p:column colspan="9" style="text-align:right"> -->
								<!-- 										<h:outputText value="الاجمالى :" /> -->
								<!-- 									</p:column> -->
								<!-- 									<p:column> -->
								<!-- 										<h:outputText -->
								<!-- 											value="#{penalitiesListBean.penalitiesList.stream().map(fdet->fdet.fineAmount).sum()}"> -->
								<!-- 											<f:convertNumber type="currency" currencySymbol="SAR" /> -->
								<!-- 										</h:outputText> -->
								<!-- 									</p:column> -->
								<!-- 								</p:summaryRow> -->

								<p:columnGroup type="footer">
									<p:row>
										<p:column colspan="9" style="text-align:center; background : grey ; font-size : bold;"
											footerText="الاجمالى :" />
										<p:column style="text-align:right ; background : grey ; font-size : bold;"
											footerText="#{penalitiesListBean.penalitiesList.stream().map(fdet->fdet.fineAmount).sum()}" />
										<p:column  style="text-align:left; background : grey ; font : bold"/>
									</p:row>
								</p:columnGroup>
							</p:dataTable>


						</div>
						<p:dialog widgetVar="penality_dlg" id="penality_dlgId" width="70%"
							style="margin-top: 7px;" hideEffect="fade" showEffect="explode"
							dir="rtl" modal="true" resizable="false">
							<h:panelGroup id="myDialog">
								<h:outputLabel value="تم تسديد الفاتورة"
									rendered="#{penalitiesListBean.reqFinesMaster.fFineCase==2}"
									style="color: red;font-size: larger;" styleClass="btxt" />

								<div style="width: 100%">

									<p:fieldset legend="بيانات المخالفة">
										<div>

											<div class="ui-g">

												<div class="ui-g-2">
													<h:outputLabel style=" font-weight: bold"
														value="#{msg['penality.number']}" styleClass="btxt" />
												</div>
												<div class="ui-g-2">
													<h:outputLabel
														value="#{penalitiesListBean.reqFinesMaster.fineNo}" />
												</div>
												<div class="ui-g-2">
													<h:outputLabel style=" font-weight: bold"
														value="تاريخ المخالفة" styleClass="btxt" />
												</div>
												<div class="ui-g-2">
													<h:outputLabel
														value="#{penalitiesListBean.reqFinesMaster.fineDate}">
														<f:convertDateTime pattern="yyyy-MM-dd"></f:convertDateTime>
													</h:outputLabel>
												</div>
												<div class="ui-g-2">
													<h:outputLabel style=" font-weight: bold"
														value="حالة السداد" styleClass="btxt" />
												</div>
												<div class="ui-g-2">
													<h:outputLabel
														style="color:#{(penalitiesListBean.reqFinesMaster.fFineCase==1)? 'green' : 'red'}"
														value="#{(penalitiesListBean.reqFinesMaster.fFineCase==1)? msg['paid'] : msg['not.paid']}" />
												</div>

											</div>
											<div class="ui-g">
												<div class="ui-g-2">
													<h:outputLabel style=" font-weight: bold"
														value="نوع النشاط" styleClass="btxt" />
												</div>
												<div class="ui-g-2">
													<h:outputLabel
														value="#{penalitiesListBean.reqFinesMaster.activityName}" />
												</div>
												<div class="ui-g-2">
													<h:outputLabel rendered="false" value="رقم الشكوى"
														styleClass="btxt" />
												</div>
												<div class="ui-g-2">
													<h:outputLabel rendered="false"
														value="#{penalitiesListBean.reqFinesMaster.fLetterNo}" />
												</div>

											</div>
											<div class="ui-g">
												<div class="ui-g-2">
													<h:outputLabel style=" font-weight: bold"
														value="الإدارة المختصة" styleClass="btxt" />
												</div>
												<div class="ui-g-4">
													<h:outputLabel
														value="#{penalitiesListBean.reqFinesMaster.deptName}" />
												</div>
												<div class="ui-g-2">
													<h:outputLabel style=" font-weight: bold" value="المراقب"
														styleClass="btxt" />
												</div>
												<div class="ui-g-4">
													<h:outputLabel
														value="#{penalitiesListBean.reqFinesMaster.supervisorName}" />
												</div>

											</div>



										</div>

										<br />
										<br />
									</p:fieldset>

									<p:fieldset legend="بيانات المخالف">
										<div class="ui-g">

											<div class="ui-g-2">
												<h:outputLabel style=" font-weight: bold" value="رقم الرخصة"
													styleClass="btxt" />
											</div>
											<div class="ui-g-4">
												<h:outputLabel
													value="#{penalitiesListBean.reqFinesMaster.fLicenceNo}" />
											</div>
											<div class="ui-g-2">
												<h:outputLabel style=" font-weight: bold"
													value="#{msg['commercial.name']}" styleClass="btxt" />
											</div>
											<div class="ui-g-4">
												<h:outputLabel
													value="#{penalitiesListBean.reqFinesMaster.fTradeMarkName}" />
											</div>

										</div>



										<div class="ui-g">

											<div class="ui-g-2">
												<h:outputLabel style=" font-weight: bold"
													value="صاحب المنشأة" styleClass="btxt" />
											</div>
											<div class="ui-g-4">
												<h:outputLabel
													value="#{penalitiesListBean.reqFinesMaster.fName}" />
											</div>
											<div class="ui-g-2">
												<h:outputLabel rendered="false" value="الرقم المميز"
													styleClass="btxt" />
											</div>
											<div class="ui-g-4">
												<h:outputLabel rendered="false"
													value="#{penalitiesListBean.reqFinesMaster.fKeycode}" />

											</div>
										</div>

										<div class="ui-g">

											<div class="ui-g-2">
												<h:outputLabel style=" font-weight: bold"
													value="عنوان المنشأة" styleClass="btxt" />
											</div>
											<div class="ui-g-10">
												<h:outputLabel
													value="#{penalitiesListBean.reqFinesMaster.fAddress}" />
											</div>

										</div>


										<div class="ui-g">

											<div class="ui-g-2">
												<h:outputLabel rendered="false" style=" font-weight: bold"
													value="رقم المخطط" styleClass="btxt" />
											</div>
											<div class="ui-g-4">
												<h:outputLabel rendered="false"
													value="#{penalitiesListBean.reqFinesMaster.fMapNo}" />
											</div>
											<div class="ui-g-2">
												<h:outputLabel rendered="false" style=" font-weight: bold"
													value="رقم القطعة" styleClass="btxt" />
											</div>
											<div class="ui-g-4">
												<h:outputLabel rendered="false"
													value="#{penalitiesListBean.reqFinesMaster.fBlockNo}" />
											</div>

										</div>





										<div class="ui-g">

											<div class="ui-g-2">
												<h:outputLabel style=" font-weight: bold"
													value="تاريخ بداية الرخصة" styleClass="btxt" />
											</div>
											<div class="ui-g-4">
												<h:outputLabel
													value="#{penalitiesListBean.reqFinesMaster.fLicStartDate}" />
											</div>
											<div class="ui-g-2">
												<h:outputLabel style=" font-weight: bold"
													value="تاريخ نهاية الرخصة" styleClass="btxt" />
											</div>
											<div class="ui-g-2">
												<h:outputLabel
													value="#{penalitiesListBean.reqFinesMaster.fLicEndDate}" />
											</div>
										</div>




									</p:fieldset>
									<p:fieldset legend="بيانات المخالفات">
										<div class="ui-g">

											<div class="table-responsive"
												style="position: relative; overflow-y: auto; width: 98%; padding-right: 27px;">


												<table class="table table-striped table-hover">
													<thead>
														<tr>

															<td style="font-size: 15px; font-weight: bold">عنوان
																المخالفة</td>
															<td style="font-size: 15px; font-weight: bold">التكرار</td>
															<td style="font-size: 15px; font-weight: bold">الحد
																الادنى</td>
															<td style="font-size: 15px; font-weight: bold">الحد
																الأعلى</td>
															<td style="font-size: 15px; font-weight: bold">العدد</td>
															<td style="font-size: 15px; font-weight: bold">القيمة</td>
															<td style="font-size: 15px; font-weight: bold">الإجمالي</td>


														</tr>
													</thead>
													<tbody>
														<ui:repeat var="fdet" varStatus="x"
															value="#{penalitiesListBean.reqFinesMaster.reqFinesDetailsList}">
															<tr>
																<td>#{fdet.reqFinesSetup.fineAction}</td>
																<td>#{fdet.fineCount}</td>
																<td>#{fdet.reqFinesSetup.fineMinimumValue}</td>
																<td>#{fdet.reqFinesSetup.fineSupermumValue}</td>
																<td width="12%">#{fdet.fineCount}</td>
																<td width="10%"><p:inputText size="4" id="notValue"
																		style=" opacity:1;" disabled="true"
																		value="#{fdet.fineValue}">
																		<p:ajax event="blur" process="@this,notValue"
																			update="sumId" />
																	</p:inputText></td>
																<td width="10%"><p:outputLabel
																		value="#{fdet.fineTotalValue}" id="sumId" /></td>




															</tr>

														</ui:repeat>
													</tbody>
													<tfoot>
														<tr>

															<th align="left" colspan="6" style="margin-right: 50px">
																#{penalitiesListBean.reqFinesMaster.reqFinesDetailsList.stream().map(fdet->fdet.fineTotalValue).sum()}
															</th>
														</tr>
													</tfoot>
												</table>
											</div>

										</div>

									</p:fieldset>
									<br />
									<div>

										<p:commandButton type="button" class="btn btn-primary"
											onclick="PF('penality_dlg').hide();" value="رجوع"
											style="float:left;margin-left:3px;"
											icon="ui-icon ui-icon-keyboard-arrow-left"
											styleClass=" orange-btn"></p:commandButton>
										<p:commandButton style="float:left;margin-left:3px;"
											value="طباعة الفاتورة" styleClass="purple-btn"
											icon="ui-icon ui-icon-print" ajax="false"
											onclick="this.form.target='_blank'"
											action="#{penalitiesListBean.printBillReport}">
										</p:commandButton>
										<p:commandButton style="float:left;margin-left:3px;"
											ajax="false" value="طباعة المخالفة" id="bt1"
											icon="ui-icon ui-icon-print"
											onclick="this.form.target='_blank'" styleClass="purple-btn"
											action="#{penalitiesListBean.printPenalityReport}">
										</p:commandButton>

										<!-- 										<p:commandButton style="float:left;margin-left:3px;" -->
										<!-- 											value="طباعة المحضر" id="bt2" styleClass="purple-btn" -->
										<!-- 											ajax="false" onclick="this.form.target='_blank'" -->
										<!-- 											icon="ui-icon ui-icon-print" -->
										<!-- 											action="#{penalitiesListBean.printReportPenalityAction}"> -->
										<!-- 										</p:commandButton> -->

										<!-- 										<p:commandButton style="float:left;margin-left:3px;" -->
										<!-- 											value="موافق" styleClass="btn btn-primary" update="myDialog" -->
										<!-- 											rendered="#{(penalitiesListBean.reqFinesMaster.fFineCase==0)}" -->
										<!-- 											action="#{penalitiesListBean.acceptPenality}"> -->
										<!-- 										</p:commandButton> -->

									</div>
								</div>
							</h:panelGroup>
							<div />
						</p:dialog>
					</div>
				</h:form>
			</ui:define>
		</ui:composition>

	</h:body>
</f:view>
</html>
